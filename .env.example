# =============================================================================
# SOOTIO - STREMIO DEBRID ADDON CONFIGURATION
# =============================================================================
# This file contains all configuration options for the Sootio addon.
# Copy this file to .env and configure according to your needs.
# =============================================================================

# --- BASIC CONFIGURATION ---
# Addon URL: The domain/URL where your addon is hosted (e.g., sooti.info or http://localhost:55771)
ADDON_URL=YOUR_ADDON_URL

# Server port (default: 55771)
PORT=55771

# Logging level (error, warn, info, debug)
LOG_LEVEL=error

# Debug logs for debrid services (true/false)
DEBRID_DEBUG_LOGS=false
RD_DEBUG_LOGS=false

# --- TORRENT SCRAPERS CONFIGURATION ---
# Configure multiple torrent sources to search for content

## Jackett (TorZNab API - multi-indexer support)
JACKETT_ENABLED=true
JACKETT_URL=YOUR_JACKETT_URL
JACKETT_API_KEY=JACKETT_API_KEY

# Custom HTML to display on the configuration page
# This allows you to add custom branding, promotions, or information
# Leave empty ("") to disable custom HTML
# When adding HTML, ensure it's properly escaped and on a single line
# Example usage:
# CUSTOM_HTML="<div style='padding: 20px; text-align: center;'><h2>Welcome to My Addon</h2><p>Custom message here</p></div>"
CUSTOM_HTML=""

# Default debrid service provider (for new configurations)
# Set to your preferred default service when users first configure the addon
# Options: RealDebrid, TorBox, AllDebrid, Premiumize, OffCloud, DebriderApp, Usenet, HomeMedia, httpstreaming
DEFAULT_DEBRID_SERVICE="RealDebrid"
TORZNAB_LIMIT=100

## Zilean (DMM hash database)
ZILEAN_ENABLED=true
ZILEAN_URL="https://zilean.elfhosted.com"
ZILEAN_LIMIT=200

## Torrentio (Stremio addon bridge)
TORRENTIO_ENABLED=false
TORRENTIO_URL="https://torrentio.strem.fun"

## Comet (Debrid-optimized aggregator)
COMET_ENABLED=false
COMET_URL="https://comet.elfhosted.com"

## StremThru (Premium torrent search)
STREMTHRU_ENABLED=false
STREMTHRU_URL="https://stremthru.elfhosted.com"

## Bitmagnet (Self-hosted DHT crawler)
BITMAGNET_ENABLED=false
BITMAGNET_URL="BITMAGNET_URL"

## Snowfl (Torrent search via snowfl-api)
SNOWFL_ENABLED=false

## 1337x (Direct HTML scraping)
TORRENT_1337X_ENABLED=true
TORRENT_1337X_URL="https://1337x.to"
TORRENT_1337X_LIMIT=200
TORRENT_1337X_MAX_PAGES=5

## BTDigg (DHT search)
BTDIG_ENABLED=true
BTDIG_URL="https://btdig.com"
BTDIG_LIMIT=50
BTDIG_MAX_PAGES=5
# Enable free rotating proxies to reduce blocking
BTDIG_USE_PROXIES=false

## MagnetDL (Direct HTML scraping)
MAGNETDL_ENABLED=true
MAGNETDL_URL="https://magnetdl.homes"
MAGNETDL_LIMIT=200

## TorrentGalaxy (Torrent aggregator)
TORRENT_GALAXY_ENABLED=false
TORRENT_GALAXY_URL="https://torrentgalaxy.one"

## Torrent9 (French torrent site)
TORRENT9_ENABLED=false
TORRENT9_URL="https://www.torrent9.town"

## Wolfmax4K (High-quality 4K content)
WOLFMAX4K_ENABLED=false
WOLFMAX4K_URL="https://wolfmax4k.com"

## BluDV (Brazilian torrent site)
BLUDV_ENABLED=false
BLUDV_URL="https://bludv.net"
BLUDV_LIMIT=50

## Knaben (Torrent search engine)
KNABEN_ENABLED=false
KNABEN_URL="https://api.knaben.org"
KNABEN_LIMIT=300

## Global Scraper Settings
SCRAPER_TIMEOUT=5000

# --- HTTP STREAMING PROVIDERS ---
# Direct HTTP streaming link providers (configured via UI, not env vars)
# Supported providers: 4KHDHub, UHDMovies with PixelDrain/Google Drive integration

# UHDMovies specific settings
UHDMOVIES_PROXY_URL=
UHDMOVIES_REQUEST_TIMEOUT=10000
UHDMOVIES_REQUEST_MAX_RETRIES=3
UHDMOVIES_REQUEST_RETRY_DELAY=1000
UHDMOVIES_DOMAIN_TIMEOUT=5000
UHDMOVIES_DOMAIN_MAX_RETRIES=3
UHDMOVIES_DOMAIN_RETRY_DELAY=2000
UHDMOVIES_DOMAIN_CACHE_TTL=86400000
UHDMOVIES_VALIDATION_TIMEOUT=3000

# HTTP streaming validation settings
DISABLE_URL_VALIDATION=false
DISABLE_SEEK_VALIDATION=false
HTTP_TIMEOUT=5000
HTTP_RESOLVE_TIMEOUT=10000
HTTP_RESOLVE_CACHE_TTL_MS=3600000

# --- QUALITY & FILTERING SETTINGS ---
# Control which torrents are prioritized and filtered

## Quality Tier Skipping
PRIORITY_SKIP_WEBRIP_ENABLED=true
PRIORITY_SKIP_AAC_OPUS_ENABLED=true

## Per-Quality Result Limits
MAX_RESULTS_REMUX=2
MAX_RESULTS_BLURAY=2
MAX_RESULTS_WEBDL=2
MAX_RESULTS_WEBRIP=1
MAX_RESULTS_AUDIO=1
MAX_RESULTS_OTHER=10

## Codec Diversity (balance H.264 vs H.265)
DIVERSIFY_CODECS_ENABLED=true
MAX_H265_RESULTS_PER_QUALITY=2
MAX_H264_RESULTS_PER_QUALITY=2

## Global Limits & Exit Conditions
TARGET_CODEC_COUNT=10
EARLY_EXIT_QUALITY_THRESHOLD=BluRay

# --- SEASON PACK HANDLING ---
# Configure how season packs are inspected for TV shows
MAX_PACKS_TO_INSPECT=6
MAX_PACK_ROUNDS=2

# --- DEBRID SERVICES RATE LIMITS ---
# Configure API rate limits and concurrency for debrid providers
# NOTE: Rate limits are PER API TOKEN (per user), not global

## Real-Debrid
RD_RATE_PER_MINUTE=250
# Increased default from 10 to 30 for better multi-user support
# Since rate limit is per token, higher concurrency is safe
RD_CONCURRENCY=30
RD_PERSONAL_CACHE_TTL_MINUTES=5
RD_MAX_RETRIES=3

## All-Debrid
AD_RATE_PER_MINUTE=600
AD_RATE_PER_SECOND=12
AD_CONCURRENCY=50
AD_MAX_RETRIES=5
# Number of parallel hash checks (upload → check → delete)
# Higher = faster but uses more API calls. Recommended: 10-20
AD_CHECK_CONCURRENCY=10

# --- PROXY CONFIGURATION ---
# Optional proxy for debrid services, scrapers, and streaming

# Proxy URL (HTTP/HTTPS/SOCKS5)
# Examples:
#   WARP in Docker:  DEBRID_HTTP_PROXY=socks5h://warp:1080
#   WARP on host:    DEBRID_HTTP_PROXY=socks5h://127.0.0.1:1080
#   HTTP proxy:      DEBRID_HTTP_PROXY=http://proxy:8080
# Note: Use socks5h:// (not socks5://) to resolve hostnames through the proxy
DEBRID_HTTP_PROXY=

# Services to proxy (comma-separated)
# Available: realdebrid, alldebrid, torbox, premiumize, offcloud, debrider, scrapers, httpstreams
# Examples:
#   DEBRID_PROXY_SERVICES=*:true                              (proxy everything)
#   DEBRID_PROXY_SERVICES=realdebrid:true,alldebrid:true    (only debrid services)
#   DEBRID_PROXY_SERVICES=scrapers:true,httpstreams:true    (only scrapers and streaming)
DEBRID_PROXY_SERVICES=*:false

# --- CLUSTERING & PERFORMANCE ---
# Multi-worker process configuration for high-load scenarios

# Number of worker processes (default: 10, max: 32, auto-capped to CPU cores)
# Use with: npm run start (uses cluster mode by default)
# For single process: npm run standalone
MAX_WORKERS=10

# UV thread pool size for better I/O performance (default: 4)
UV_THREADPOOL_SIZE=128

# HTTP server settings
HTTP_KEEPALIVE_TIMEOUT=65000
HTTP_HEADERS_TIMEOUT=72000
HTTP_TIMEOUT=120000

# HTTP server limits for multi-user support
# Increased from 200 to 500 for better scalability
# Each user typically uses 1-2 concurrent connections
HTTP_MAX_CONNECTIONS=500
HTTP_MAX_HEADERS_COUNT=50

# --- MONGODB CACHE ---
# Optional persistent cache for magnet availability across providers
# Highly recommended for multi-user scenarios and better performance

MONGO_CACHE_ENABLED=false

# MongoDB connection string
# Examples:
#   Local:         mongodb://localhost:27017
#   Remote:        mongodb://user:pass@your-server.com:27017
#   MongoDB Atlas: mongodb+srv://user:pass@cluster.mongodb.net/
MONGO_URI=mongodb://localhost:27017

# Database and collection names
MONGO_DB_NAME=sootio
MONGO_CACHE_COLLECTION=magnet_cache

# Cache TTL in days (entries auto-expire via TTL index)
MONGO_CACHE_TTL_DAYS=180

# Force cleanup of duplicate entries on startup (performance impact)
MONGO_FORCE_CLEANUP=false

# --- USENET CONFIGURATION ---
# Optional Usenet support via Newznab indexers and SABnzbd
# Note: Usenet services are configured via the UI, not environment variables

# File server for progressive Usenet streaming
USENET_FILE_SERVER_URL=http://localhost:8765
USENET_FILE_SERVER_API_KEY=your_api_key_here

# --- CACHE CONFIGURATION ---
# Control caching behavior for various components

# Scraper result caching
SCRAPER_CACHE_TTL_MOVIE_MIN=360
SCRAPER_CACHE_TTL_SERIES_MIN=60
SCRAPER_CACHE_LIMIT=5000

# Parse-torrent-title cache
PTT_CACHE_LIMIT=10000

# General cache settings
CACHE_MAX_AGE=60
DISABLE_CACHE=false

# --- ADVANCED SETTINGS ---
# Additional configuration options for fine-tuning

# Request retry settings
REQUEST_TIMEOUT=30000
REQUEST_MAX_RETRIES=3
REQUEST_RETRY_DELAY=1000

# Admin token for protected endpoints (optional)
ADMIN_TOKEN=

# Host binding (default: 0.0.0.0)
HOST=0.0.0.0
